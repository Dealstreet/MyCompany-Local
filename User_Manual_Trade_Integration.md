[사용자 매뉴얼] 아이폰 문자 자동 연동 가이드

이 문서는 사용자의 "미래에셋증권 체결 문자"를 "AI 회사 시스템"으로 자동으로 보내기 위한 설정 방법입니다.
천천히 순서대로 따라해 주세요.

============================================================
1단계: 준비물 챙기기 (Secret Key 확인)
============================================================

1. 컴퓨터에서 서버를 켜고 관리자 페이지에 접속하세요.
   - 주소: http://127.0.0.1:8000/admin/
   
2. [로그인] 후, 화면 아래쪽 'CORE' 섹션에 있는 **"User profiles"**를 클릭하세요.

3. 목록에 있는 본인의 이름(예: admin의 프로필)을 클릭하세요.

4. 화면 중간에 있는 **"연동 API Key"** 부분의 이상한 영어+숫자 조합을 복사하세요.
   (예: Lz8fXy-3g0d... 처럼 생긴 긴 문자열입니다)
   *주의: 이 키는 비밀번호 같은 것이니 남에게 보여주지 마세요.*

============================================================
2단계: 아이폰 '단축어' 앱 설정하기
============================================================

아이폰을 켜고 [단축어] 앱을 실행합니다. 하단 메뉴 중 [자동화] 탭으로 이동하세요.

1. **[+새로운 자동화]** 버튼을 누릅니다. (또는 우측 상단 + 버튼)

2. 목록에서 **[메시지]** 항목을 찾아서 누릅니다.
   - [보낸 사람]: '선택'을 누르고 "미래에셋" 또는 문자가 오는 번호(1588-6800 등)를 검색해서 선택.
   - [메시지 내용]: 비워두거나 "체결" 이라고 씁니다. (모든 문자를 다 받으려면 비워두세요)
   - [다음] 버튼 터치.

3. 동작을 설정하는 화면이 나옵니다. **[+동작 추가]** 검색창에 **"URL 내용 가져오기"**를 검색해서 선택하세요.
   (아이콘: 🌐 지구본 모양)

4. 추가된 동작을 다음과 같이 세팅합니다:
   
   (1) URL 칸 터치:
       - 컴퓨터에서 `start_tunnel.ps1`을 실행하면 나오는 주소를 사용합니다.
       - 입력할 주소: **https://(영문숫자조합).ngrok-free.app/api/webhook/sms/**
       - (주의: ngrok을 껐다 켜면 주소가 바뀔 수 있습니다. 고정하려면 유료 결제가 필요하거나 로그인이 필요할 수 있습니다.)
   
   (2) [GET] 이라고 써있는 파란 글씨를 터치 -> **[POST]**로 변경.

   (3) [헤더] 옆의 화살표(>)를 누르고 [+] 추가:
       - 키: Content-Type
       - 값: application/json

   (4) [요청 본문] 선택 -> **[JSON]** 선택.

   (5) [+새로운 필드 추가]를 눌러서 3개를 만듭니다: (왼쪽이 이름, 오른쪽이 값)
       
       - 이름: secret_key
         값: (아까 1단계에서 복사한 그 긴 비밀 키 붙여넣기)
       
       - 이름: sms_content
         값: 키보드 위의 변수 추천에서 **[단축어 입력]** 선택 -> 그걸 터치해서 **[메시지]** 또는 **[내용]**으로 변경
       
       - 이름: received_at
         값: 키보드 위의 변수 추천에서 **[현재 날짜]** 선택

5. **[완료]**를 눌러 저장합니다.
   - "실행 전에 묻기"는 끄는 것이 편합니다.

============================================================
3단계: 테스트 하기
============================================================

1. 아이폰의 단축어 자동화가 잘(실행 전에 묻기 끔) 되어 있는지 확인합니다.

2. 테스트 문자가 왔다고 가정하고, 단축어 앱의 ▶ 재생 버튼으로 테스트해보거나,
   지인에게 부탁해서 아래와 같은 **정확한 형식**의 문자를 보내달라고 해보세요. (띄어쓰기 중요)
   
   ```text
   [미래에셋증권]
   종목명: 삼성전자(005930)
   매매구분: 매수
   체결수량: 10주
   체결단가: 70,000원
   주문번호: 12345
   ```
   (팁: 위 내용을 복사해서 나에게 보내기 하셔도 됩니다)

3. 컴퓨터의 [투자 관리] 페이지(http://127.0.0.1:8000/investment/)에 들어갑니다.

4. 리스트에 **[📱 문자]** 뱃지가 달린 내역이 짠! 하고 나타나면 성공입니다.

============================================================
※ 잘 안 되나요?
============================================================
- 컴퓨터 방화벽이 8000번 포트를 막고 있을 수 있습니다. (인바운드 규칙 확인)
- 외부 접속(DDNS)을 위한 공유기 포트포워딩 설정(5438 -> 8000)이 올바른지 확인하세요.
- 문자가 'MMS(긴 문자)'로 오면 내용이 제대로 안 넘어갈 수도 있습니다.
