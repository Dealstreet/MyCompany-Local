<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì„œ ìƒì„¸ - ê¼¼ë§ì»´í¼ë‹ˆ CIS</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { margin: 0; display: flex; height: 100vh; background-color: #f0f2f5; overflow: hidden; }
        a { text-decoration: none; color: inherit; }
        
        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar { width: 260px; background-color: #1e293b; color: white; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .logo { font-size: 18px; font-weight: 700; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; color: #fff; cursor: pointer; }
        .menu-btn { width: 100%; padding: 12px 15px; border-radius: 6px; font-size: 14px; font-weight: 600; color: white; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; transition: opacity 0.2s; }
        .btn-orange { background: linear-gradient(135deg, #f2994a, #f2c94c); }
        .btn-blue { background: linear-gradient(135deg, #2980b9, #3498db); }
        .btn-purple { background: linear-gradient(135deg, #8e44ad, #9b59b6); }
        
        /* ì»¨í…ì¸  ì˜ì—­ */
        .content-area { flex: 1; padding: 40px; overflow-y: auto; display: flex; justify-content: center; }
        .paper { width: 100%; max-width: 900px; background: white; padding: 50px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); height: fit-content; }
        
        /* ì—ë””í„° ë†’ì´ ì„¤ì • */
        .ck-editor__editable_inline {
            min-height: 550px;
            font-family: 'Malgun Gothic', sans-serif;
        }

        .doc-header { border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-end; }
        .action-bar { border-top: 1px solid #eee; padding-top: 20px; margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px; }
        .btn { padding: 10px 20px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-approve { background-color: #2ecc71; color: white; }
        .btn-save { background-color: #3498db; color: white; }
        .btn-back { background-color: #95a5a6; color: white; }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="{% url 'index' %}" class="logo">ğŸ¢ ê¼¼ë§ì»´í¼ë‹ˆ CIS</a>
        <a href="{% url 'create_self_approval' %}" class="menu-btn btn-orange">ğŸ“ ì§ì ‘ ê¸°ì•ˆ ì‘ì„±</a>
        <a href="{% url 'approval_list' %}" class="menu-btn btn-blue">ğŸ“‚ ì „ìê²°ì¬í•¨</a>
        <a href="{% url 'org_chart' %}" class="menu-btn btn-purple">ğŸ“Š ì¡°ì§ë„ ë³´ê¸°</a>
    </div>

    <div class="content-area">
        <div class="paper">
            <div class="doc-header">
                <div style="font-size: 24px; font-weight: bold;">{{ approval.title }}</div>
                <div style="font-size: 12px; color: #888;">ë¬¸ì„œë²ˆí˜¸: {{ approval.id }}</div>
            </div>
            
            <form method="post" id="approvalForm">
                {% csrf_token %}
                <div class="doc-body">
                    {% if approval.status == 'approved' or approval.status == 'rejected' %}
                        <div style="border:1px solid #eee; padding:20px; background-color: #fff;">
                            {{ approval.content|safe }}
                        </div>
                    {% else %}
                        <textarea name="content" id="editor">{{ approval.content }}</textarea>
                    {% endif %}
                </div>

                <div class="action-bar">
                    <a href="{% url 'approval_list' %}" class="btn btn-back">ëª©ë¡ìœ¼ë¡œ</a>
                    {% if approval.status != 'approved' and approval.status != 'rejected' %}
                        <button type="submit" name="action" value="save" class="btn btn-save">ë‚´ìš©ë§Œ ì €ì¥</button>
                        <button type="submit" name="action" value="approve" class="btn btn-approve">ìµœì¢… ìŠ¹ì¸</button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <script>
        // CKEditor 5 ì„¤ì •: ëª¨ë“  HTML íƒœê·¸ ë° ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ í—ˆìš©
        if (document.querySelector('#editor')) {
            ClassicEditor
                .create(document.querySelector('#editor'), {
                    language: 'ko',
                    // í–‰ì•ˆë¶€ ì„œì‹(style="") ë³´ì¡´ì„ ìœ„í•œ í•µì‹¬ ì„¤ì •
                    htmlSupport: {
                        allow: [
                            {
                                name: /.*/,        // ëª¨ë“  íƒœê·¸ í—ˆìš©
                                attributes: true,  // ëª¨ë“  ì†ì„± í—ˆìš©
                                classes: true,     // ëª¨ë“  í´ë˜ìŠ¤ í—ˆìš©
                                styles: true       // ëª¨ë“  ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ í—ˆìš©
                            }
                        ]
                    },
                    toolbar: [
                        'heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 
                        'insertTable', 'blockQuote', 'undo', 'redo'
                    ]
                })
                .then(editor => {
                    console.log('ì—ë””í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch(error => {
                    console.error('ì—ë””í„° ë¡œë“œ ì—ëŸ¬:', error);
                });
        }
    </script>
</body>
</html>