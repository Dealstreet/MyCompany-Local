{% extends "base.html" %}

{% block title %}ê²°ì¬ ìƒì„¸ - ê¼¼ë§ì»´í¼ë‹ˆ CIS{% endblock %}

{% block content %}
<style>
    /* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€ ... */
    .official-doc-container { padding: 40px; background-color: #f4f4f4; display: flex; justify-content: center; overflow-y: auto; height: 100%; }
    .official-document { width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-shadow: 0 0 15px rgba(0,0,0,0.15); display: flex; flex-direction: column; color: #000; }
    .doc-header { border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 25px; }
    .org-name { font-size: 26px; font-weight: 900; text-align: center; letter-spacing: 8px; margin-bottom: 25px; }
    .header-info-grid { display: grid; grid-template-columns: 80px 1fr; gap: 8px; font-size: 14px; }
    .info-label { font-weight: 700; display: flex; align-items: center; }
    .editable-input { border: 1px solid #ddd; padding: 4px 8px; border-radius: 4px; width: 100%; font-size: 14px; }
    .doc-body { flex: 1; margin-top: 10px; }
    .title-area { display: flex; align-items: center; gap: 10px; margin-bottom: 25px; }
    .title-label { font-size: 18px; font-weight: 800; white-space: nowrap; }
    .title-input { font-size: 18px; font-weight: 800; border: 1px solid #ddd; padding: 5px; width: 100%; }
    .doc-content { width: 100%; border: none; outline: none; resize: none; min-height: 500px; font-size: 15px; line-height: 1.8; text-align: justify; white-space: pre-wrap; }
    .doc-footer { margin-top: 40px; border-top: 1px solid #000; padding-top: 20px; }
    .footer-stamp { text-align: center; font-size: 22px; font-weight: 900; margin: 40px 0; letter-spacing: 12px; }
    .footer-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px; color: #333; }
    .action-panel { position: fixed; right: 50px; top: 100px; display: flex; flex-direction: column; gap: 15px; }
    .btn-action { width: 150px; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.2s; }
    .btn-approve { background: #27ae60; color: white; }
    .btn-reject { background: #e74c3c; color: white; }
    .btn-save { background: #3498db; color: white; }
    .btn-action:hover { transform: translateY(-2px); filter: brightness(1.1); }
</style>

<div class="official-doc-container">
    <form method="post" class="official-document">
        {% csrf_token %}
        
        <div class="doc-header">
            <div class="org-name">ê¼¼ ë§ ì»´ í¼ ë‹ˆ</div>
            <div class="header-info-grid">
                <div class="info-label">ìˆ˜ì‹ </div>
                <div><input type="text" name="recipient" class="editable-input" value="ì‚¬ì¥ì‹¤(ëŒ€í‘œì´ì‚¬)"></div>
                <div class="info-label">ê²½ìœ </div>
                <div><input type="text" name="via" class="editable-input" value="í•´ë‹¹ì—†ìŒ"></div>
            </div>
        </div>

        <div class="doc-body">
            <div class="title-area">
                <div class="title-label">ì œëª©:</div>
                <input type="text" name="title" class="title-input" value="{{ approval.title }}">
            </div>
            
            <textarea name="content" class="doc-content">
1. ê´€ë ¨: {{ approval.title }}

2. ìœ„ ê´€ë ¨, ë‹¹ì‚¬ {% if approval.agent %}{{ approval.agent.department }}{% else %}ìš´ìš©ë¶€ì„œ{% endif %}ì—ì„œ ê´€ë¦¬ ì¤‘ì¸ ì¢…ëª©ì— ëŒ€í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ë§¤ìˆ˜ ì§‘í–‰ì„ ì™„ë£Œí•˜ê³  ê¸°ì•ˆí•˜ì˜¤ë‹ˆ ê²€í†  í›„ ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

{% if approval.investment_log %}
  ê°€. ì¢…ëª©ì½”ë“œ: {{ approval.investment_log.stock_code }}
  ë‚˜. ë§¤ìˆ˜ì¼ì‹œ: {{ approval.investment_log.created_at|date:"Y-m-d H:i" }}
  ë‹¤. ë§¤ìˆ˜ìˆ˜ëŸ‰: {{ approval.investment_log.quantity }}ì£¼
  ë¼. ë§¤ìˆ˜ë‹¨ê°€: {{ approval.investment_log.avg_price|floatformat:0 }}ì›
  ë§ˆ. ì´ ë§¤ìˆ˜ê¸ˆì•¡: {{ approval.investment_log.total_amount|floatformat:0 }}ì›
{% elif approval.report_type == 'buy' or approval.report_type == 'sell' %}
  ê°€. ì¢…ëª©ì½”ë“œ: {{ approval.temp_stock_code }}
  ë‚˜. ê±°ë˜ì¼ì: {{ approval.temp_date|default:"(ë¯¸ì…ë ¥)" }}
  ë‹¤. ê±°ë˜ìˆ˜ëŸ‰: {{ approval.temp_quantity }}ì£¼
  ë¼. ì´ ë§¤ìˆ˜ê¸ˆì•¡: {{ approval.temp_total_amount|floatformat:0 }}ì›
  ë§ˆ. ìƒì„¸ë‚´ìš©: ì‚¬ì¥ë‹˜ ì§€ì‹œì— ë”°ë¥¸ {% if approval.report_type == 'buy' %}ë§¤ìˆ˜{% else %}ë§¤ë„{% endif %} ì§‘í–‰ ë³´ê³  ê±´ì…ë‹ˆë‹¤.
{% else %}
  (ìƒì„¸ ë§¤ìˆ˜ ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)
{% endif %}

3. í–¥í›„ í•´ë‹¹ ì¢…ëª©ì˜ ì‹œì¥ ë™í–¥ì„ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì—¬ íˆ¬ì ì „ëµì— ë°˜ì˜í•  ì˜ˆì •ì…ë‹ˆë‹¤.

ë¶™ì„  ê±°ë˜ ì¦ë¹™ ìë£Œ 1ë¶€.  ë.</textarea>
        </div>

        <div class="doc-footer">
            <div class="footer-stamp">ê¼¼ë§ì»´í¼ë‹ˆ ëŒ€í‘œì´ì‚¬</div>
            
            <div class="footer-meta">
                <div>ê¸°ì•ˆì: {% if approval.agent %}{{ approval.agent.name }} {{ approval.agent.position }}{% else %}{{ approval.drafter.username }}{% endif %}</div>
                <div>ê²°ì¬ì: {{ user.username }} (CEO)</div>
                <div>ì‹œí–‰ì¼ì: {{ approval.created_at|date:"Y. m. d." }}</div>
                <div>ë¬¸ì„œë²ˆí˜¸: CIS-{{ approval.id }}</div>
            </div>
        </div>

        <div class="action-panel">
            {% if approval.status == 'pending' or approval.status == 'draft' %}
                <button type="submit" name="action" value="save" class="btn-action btn-save">ğŸ’¾ ë‚´ìš© ìˆ˜ì •</button>
                <button type="submit" name="action" value="reject" class="btn-action btn-reject">âŒ ê²°ì¬ ë°˜ë ¤</button>
                <button type="submit" name="action" value="approve" class="btn-action btn-approve">âœ… ìµœì¢… ìŠ¹ì¸</button>
            {% else %}
                <div style="background: #eee; padding: 15px; border-radius: 8px; text-align: center; font-size: 13px; font-weight: bold;">
                    ì™„ë£Œëœ ë¬¸ì„œ<br>({{ approval.get_status_display }})
                </div>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}